<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mis Citas</title>
    <link rel="stylesheet" href="css/styles.css">
</head>

<body>
    <!-- Menú lateral -->
    <div class="sidebar">
        <img src="logo.png" alt="Logo">
        <button onclick="window.location.href='agendar.html'">Agendar Cita</button>
        <button onclick="window.location.href='miscitas.html'">Mis Citas</button>
        <button onclick="window.location.href='ayuda.html'">Ayuda</button>
        <button onclick="window.location.href='login.html'">Salir</button>
    </div>

    <!-- Contenido principal -->
    <div class="main-content">
        <h1>Mis Citas</h1>
        <div class="table-container">
            <table id="tablaCitas">
                <thead>
                    <tr>
                        <th>Fecha</th>
                        <th>Hora</th>
                        <th>Especialidad</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Aquí se insertan las citas -->
                </tbody>
            </table>
        </div>
    </div>

    <script>
        async function cargarCitas() {
            try {
                const res = await fetch('http://localhost:5000/miscitas');
                const citas = await res.json();

                const tbody = document.querySelector('#tablaCitas tbody');
                tbody.innerHTML = '';

                citas.forEach(cita => {
                    const fila = document.createElement('tr');
                    fila.innerHTML = `
                        <td>${cita.fecha}</td>
                        <td>${cita.hora}</td>
                        <td>${cita.especialidad}</td>
                        <td><button onclick="cancelarCita('${cita.id}')">Cancelar</button></td>
                    `;
                    tbody.appendChild(fila);
                });
            } catch (error) {
                console.error(error);
                alert('Error al cargar las citas');
            }
        }

        async function cancelarCita(id) {
            if (!confirm('¿Seguro que quieres cancelar esta cita?')) return;

            try {
                const res = await fetch(`http://localhost:5000/cancelar/${id}`, {
                    method: 'DELETE'
                });

                if (res.ok) {
                    alert('Cita cancelada');
                    cargarCitas();
                } else {
                    alert('Error al cancelar cita');
                }
            } catch (error) {
                console.error(error);
                alert('Error de conexión');
            }
        }

        cargarCitas();
    </script>
</body>

</html>